-- ============================================================================
-- RECUPERAR ACESSO DO SUPER ADMIN
-- ============================================================================
-- Este script mostra o email do Super Admin e reseta a senha para: Super@123456
-- ============================================================================

-- ============================================================================
-- PASSO 1: VERIFICAR SE EXISTE SUPER ADMIN
-- ============================================================================

SELECT 
    '========================================' as "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ";

SELECT 
    '   SUPER ADMIN ENCONTRADO' as "โ  INFORMAรรES DO SUPER ADMIN           โ";

SELECT 
    '========================================' as "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ";

-- ============================================================================
-- PASSO 2: MOSTRAR DADOS DO SUPER ADMIN
-- ============================================================================

SELECT 
    u.email as "๐ง EMAIL",
    u.full_name as "๐ค NOME",
    u.role as "๐ญ PERFIL",
    CASE WHEN u.active THEN 'โ Ativo' ELSE 'โ Inativo' END as "STATUS",
    u.created_at as "๐ CRIADO EM"
FROM users u
WHERE u.role = 'super_admin'
ORDER BY u.created_at
LIMIT 1;

-- ============================================================================
-- PASSO 3: RESETAR SENHA PARA: Super@123456
-- ============================================================================

UPDATE auth.users 
SET encrypted_password = crypt('Super@123456', gen_salt('bf'))
WHERE email IN (
    SELECT email FROM users WHERE role = 'super_admin' LIMIT 1
);

-- ============================================================================
-- PASSO 4: CONFIRMAR RESET
-- ============================================================================

SELECT 
    '========================================' as "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ";

SELECT 
    '   โ SENHA RESETADA COM SUCESSO!' as "โ  RESULTADO                             โ";

SELECT 
    '========================================' as "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ";

SELECT 
    u.email as "๐ง EMAIL PARA LOGIN",
    'Super@123456' as "๐ NOVA SENHA",
    'http://localhost:8082/#/login' as "๐ URL DE LOGIN"
FROM users u
WHERE u.role = 'super_admin'
ORDER BY u.created_at
LIMIT 1;

-- ============================================================================
-- INSTRUรรES FINAIS
-- ============================================================================

SELECT 
    '========================================' as "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ";

SELECT 
    '   COMO FAZER LOGIN' as "โ  PRรXIMOS PASSOS                       โ";

SELECT 
    '========================================' as "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ";

SELECT 
    '1. Copie o EMAIL mostrado acima' as "PASSO",
    '' as "DETALHE"
UNION ALL
SELECT 
    '2. Acesse http://localhost:8082/#/login',
    ''
UNION ALL
SELECT 
    '3. Cole o email',
    ''
UNION ALL
SELECT 
    '4. Digite a senha: Super@123456',
    ''
UNION ALL
SELECT 
    '5. Clique em ENTRAR',
    ''
UNION ALL
SELECT 
    '6. Vocรช serรก redirecionado para o Super Admin Dashboard',
    '';

-- ============================================================================
-- FIM DO SCRIPT
-- ============================================================================
